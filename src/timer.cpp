/***********************************************************************
     * File       : timer.cpp
     * Created    : Apr 17, 2016
     * Copyright  : (C) 2016 Achpile
     * Author     : Fedosov Alexander
     * Email      : achpile@gmail.com

***********************************************************************/
#include "headers.hpp"



/***********************************************************************
     * Timer
     * constructor

***********************************************************************/
ach::Timer::Timer() {
	init();

	text = new sf::Text();
	text->setFont(*resources->fonts.timer);
	text->setCharacterSize(32);
	text->setColor(sf::Color::Green);
}



/***********************************************************************
     * Timer
     * destructor

***********************************************************************/
ach::Timer::~Timer() {
	delete text;
}



/***********************************************************************
     * Timer
     * update

***********************************************************************/
void ach::Timer::update() {
	clock += frameClock;

	calc();
	updateText();
	render();
}



/***********************************************************************
     * Timer
     * updateText

***********************************************************************/
void ach::Timer::updateText() {
	char caption[32];

	snprintf(caption, sizeof(caption), "%ld:%02ld:%02ld.%03ld", hour, min, sec, usec);

	text->setString(caption);
	text->setPosition(WIDTH - 170, HEIGHT - 45);
}



/***********************************************************************
     * Timer
     * render

***********************************************************************/
void ach::Timer::render() {
	app->draw(*text);
}



/***********************************************************************
     * Timer
     * init

***********************************************************************/
void ach::Timer::init() {
	clock = 0;

	calc();
}



/***********************************************************************
     * Timer
     * calc

***********************************************************************/
void ach::Timer::calc() {
	usec = clock % 1000;
	sec  = (clock % 60000) / 1000;
	min  = (clock % 3600000) / 60000;
	hour = clock / 3600000;
}
